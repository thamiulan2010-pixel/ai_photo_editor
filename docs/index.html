<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Photo Editor</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="static/style.css">
</head>
<body>

<h1>AI Photo Editor</h1>
<form id="anime-form" method="POST" enctype="multipart/form-data">
  <input type="text" name="name" placeholder="Enter your name" required>
  <input type="file" name="image" accept="image/*" required>
  <button type="submit">Generate Anime</button>
</form>

<div class="result"></div>

<script>
const form = document.getElementById("anime-form");
const resultDiv = document.querySelector(".result");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(form);
  const name = formData.get("name");
  const imageFile = formData.get("image");

  resultDiv.innerHTML = '<div class="loader"></div>';

  // Convert uploaded image to Base64
  const reader = new FileReader();
  reader.onloadend = async () => {
    const imageBase64 = reader.result;

    const payload = {
      data: [name, imageBase64]
    };

    try {
      const response = await fetch("https://thamiulan-ai-photo-editor.hf.space/run/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!response.ok) throw new Error(`HTTP error! ${response.status}`);

      const result = await response.json();

      // Gradio returns image data under result.data[0]
      const output = result.data[0];
      const imageUrl = output.url || output; // handles both URL or Base64

      resultDiv.innerHTML = `
        <img src="${imageUrl}" alt="Generated Anime">
        <div class="user-name">Edited for: ${name}</div>
      `;
    } catch (err) {
      console.error(err);
      resultDiv.innerHTML = `<p style="color:red;">‚ùå Error: Could not connect to AI server.<br>Please try again later.</p>`;
    }
  };

  reader.readAsDataURL(imageFile);
});
</script>

</body>
</html>
